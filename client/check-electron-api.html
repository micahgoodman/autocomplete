<!DOCTYPE html>
<html>
<head>
  <title>Electron API Check</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }
    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
    }
    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    pre {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 5px;
      overflow-x: auto;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      margin: 5px;
    }
    button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <h1>Electron API Diagnostic</h1>
  
  <div id="results"></div>
  
  <h2>Test Autocomplete</h2>
  <input type="text" id="testInput" placeholder="Enter a task to autocomplete" style="width: 400px; padding: 8px;">
  <button onclick="testAutocomplete()">Test Autocomplete</button>
  
  <div id="testResult"></div>

  <script>
    const results = document.getElementById('results');
    
    function addStatus(message, isSuccess) {
      const div = document.createElement('div');
      div.className = `status ${isSuccess ? 'success' : 'error'}`;
      div.textContent = message;
      results.appendChild(div);
    }
    
    function addCode(title, code) {
      const h3 = document.createElement('h3');
      h3.textContent = title;
      results.appendChild(h3);
      
      const pre = document.createElement('pre');
      pre.textContent = code;
      results.appendChild(pre);
    }
    
    // Check 1: Is window.electron defined?
    if (typeof window.electron !== 'undefined') {
      addStatus('✅ window.electron is defined', true);
      addCode('window.electron object:', JSON.stringify(Object.keys(window.electron), null, 2));
    } else {
      addStatus('❌ window.electron is NOT defined', false);
    }
    
    // Check 2: Is autocompleteTask function available?
    if (typeof window.electron?.autocompleteTask === 'function') {
      addStatus('✅ window.electron.autocompleteTask is a function', true);
    } else {
      addStatus('❌ window.electron.autocompleteTask is NOT available', false);
    }
    
    // Check 3: Environment info
    addCode('User Agent:', navigator.userAgent);
    addCode('Platform:', navigator.platform);
    
    // Check 4: Is this running in Electron?
    const isElectron = navigator.userAgent.toLowerCase().includes('electron');
    if (isElectron) {
      addStatus('✅ Running in Electron', true);
    } else {
      addStatus('⚠️ Not running in Electron (or user agent doesn\'t indicate it)', false);
    }
    
    // Test function
    async function testAutocomplete() {
      const input = document.getElementById('testInput');
      const resultDiv = document.getElementById('testResult');
      const taskText = input.value.trim();
      
      if (!taskText) {
        resultDiv.innerHTML = '<div class="status error">Please enter a task text</div>';
        return;
      }
      
      if (typeof window.electron?.autocompleteTask !== 'function') {
        resultDiv.innerHTML = '<div class="status error">❌ Electron API not available</div>';
        return;
      }
      
      resultDiv.innerHTML = '<div class="status">⏳ Processing...</div>';
      
      try {
        console.log('Calling autocompleteTask with:', taskText);
        const response = await window.electron.autocompleteTask(taskText);
        console.log('Response:', response);
        
        if (response.success) {
          resultDiv.innerHTML = `
            <div class="status success">
              ✅ Success!<br>
              <strong>Original:</strong> ${taskText}<br>
              <strong>Completed:</strong> ${response.completedText}
            </div>
          `;
        } else {
          resultDiv.innerHTML = `
            <div class="status error">
              ❌ Failed: ${response.error || 'Unknown error'}
            </div>
          `;
        }
      } catch (error) {
        console.error('Error:', error);
        resultDiv.innerHTML = `
          <div class="status error">
            ❌ Error: ${error.message}
          </div>
        `;
      }
    }
    
    // Log to console
    console.log('=== Electron API Diagnostic ===');
    console.log('window.electron:', window.electron);
    console.log('typeof window.electron:', typeof window.electron);
    if (window.electron) {
      console.log('window.electron.autocompleteTask:', window.electron.autocompleteTask);
    }
  </script>
</body>
</html>
